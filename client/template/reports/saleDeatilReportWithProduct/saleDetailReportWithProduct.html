<template name="restaurantSaleDetailProductReport">
  {{#contentFor "headerButtonLeft"}}
      {{>ionNavBackButton path="restaurant.report" text='របាយការណ៍'}}
  {{/contentFor}}

  {{#contentFor "headerTitle"}}
      <h1 class="title">របាយការណ៍ លក់លម្អិត</h1>
  {{/contentFor}}

  {{#ionView}}
      {{#ionContent}}
          {{#autoForm schema="Restaurant.Schema.SaleReport"  id="restaurantSaleReportWithProduct" action="/restaurant/sale-detail-product-report-gen"  target="_blank"}}
              <div class="bar bar-header">
                  <button type="submit" class="button button-balanced">Generate</button>
                  <button type="reset" class="button button-stable">Reset</button>
              </div>
              <div class="content has-header overflow-scroll">
                  {{> afQuickField name='fromDate' type='datetime'}}
                  {{> afQuickField name='toDate' type="datetime"}}
                  {{> afQuickField name='customerId' type="select" options=customers }}
                  {{> afQuickField name='status' type="select" options=status }}
                  {{> afQuickField name='staffId' type="select" options=users }}
              </div>
          {{/autoForm}}
      {{/ionContent}}
  {{/ionView}}
</template>

<template name="restaurantSaleDetailProductReportGen">
  {{#if data}}
          {{#with data}}
              {{#with title}}
                  <div class="title">
                      <div class="title-1x-kh-muol">{{khName}}</div>
                      <div class="title-1x">{{enName}}</div>
                      <div style="text-decoration: underline;">របាយការណ៍ លក់លម្អិត</div>
                      <div class="title-2x">{{khAddress}}</div>
                  </div>
              {{/with}}
              {{#with header}}
                  <div style="width: 100%">
                      <div style="width: 50%; float: left">
                          <ul class="list-unstyled">
                              <li><strong>កាលបរិច្ឆេទ:</strong> {{date}}</li>
                              <li><strong>ប្រភេទវិក័យប័ត្រ:</strong> {{status}}</li>
                          </ul>
                      </div>
                      <div style="width: 50%; float: right">
                          <ul class="list-unstyled">
                              <li><strong>អតិថិជន:</strong> {{customer}}</li>
                              <li><strong>បុគ្គលិក:</strong> {{staff}}</li>
                          </ul>
                      </div>
                  </div>
              {{/with}}

              <!--Content-->
              <table class="report-content">
                  <thead class="content-header">
                  <tr>
                      <th>ល.រ</th>
                      <th>លេខវិក័យប័ត្រ</th>
                      <th>កាលបរិច្ឆេទ</th>
                      <th>បុគ្គលិក</th>
                      <th>អតិថិជន</th>
                      <th>ប្រភេទវិក័យប័ត្រ</th>
                      <!--<th>Total Cost</th>-->
                      <!--<th align="right">Paid Amount</th>-->
                      <!--<th align="right">Owed Amount</th>-->
                      <th align="right">សរុប</th>
                      {{#each grandTotalConvert}}
                          <th align="right">{{toCurrencyId}}</th>
                      {{/each}}
                  </tr>
                  </thead>

                  <tbody class="content-body">
                  {{#each content}}
                      <tr>
                          <td align="center">{{order}}</td>
                          <td>{{_id}}</td>
                          <td>{{saleDate}}</td>
                          <td>{{user}}</td>
                          <td>{{_customer.name}}</td>
                          <td>{{status}}</td>
                          <td align="right">{{total}}</td>
                          {{#each exchangeRates}}
                              <td align="right">{{exTotalFormatted}}</td>
                          {{/each}}
                      </tr>
                      <tr style="background: #ddd;">
                        <th colspan="2">
                        </th>
                        <th style="border-left: 1px solid #000;">
                          ឈ្មោះ
                        </th>
                        <th>
                          តម្លៃ
                        </th>
                        <th>
                          ចំនួន
                        </th>
                        <th>
                          បញ្ចុះតម្លៃ
                        </th>
                        <th>
                          សរុប
                        </th>
                        <th>
                          ដុល្លារ
                        </th>
                      </tr>
                        {{#each saleDetailObj}}
                        <tr>
                          <td colspan="2" style="border: none;"></td>
                          <td align="center">
                            {{_product.name}}
                          </td>
                          <td align="center">
                            {{price}}
                          </td>
                          <td align="center">
                            {{quantity}}
                          </td>
                          <td align="center">
                            {{discount}}
                          </td>
                          <td align="right">
                            {{amount}}
                          </td>
                          <td align="right">
                            {{convertToDollar amount}}
                          </td>
                        </tr>
                        {{/each}}
                  {{/each}}
                  </tbody>
                  <tbody>
                  <tr class="content-body">
                      <td colspan="6" style="text-align: right">Grand Total:</td>
                      <!--<td align="right">{{grandTotalCost}}</td>-->
                      <!--<td align="right">{{grandTotalPaidAmount}}</td>-->
                      <!--<td align="right">{{grandTotalOwedAmount}}</td>-->
                      <td align="right">{{grandTotal}}</td>
                      {{#each grandTotalConvert}}
                          <td align="right">{{totalConvert}}</td>
                      {{/each}}
                  </tr>
                  </tbody>
              </table>

          {{/with}}

  {{else}}
      <p> សូមមេត្តារងចាំ ...</p>
  {{/if}}
</template>
